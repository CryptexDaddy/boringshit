extends layout

block content
  h1= title
  .ui.column.grid(style="padding-bottom:10px;")
    .row
      .three.wide.column.borderThing(style="background:#ffffff")
        .hText.mainColorlBlue
          | Hours worked
        .lText=[...user.time_windows.filter(val => val.shift_start && val.shift_end).map(val => Math.abs(val.shift_end - val.shift_start)/3600000), ...user.time_windows.filter(val => val.shift_start && !val.shift_end).map(val => Math.abs(Date.now() - val.shift_start)/3600000)].reduce((a, b) => a + b).toFixed(2).replace('.', ':')
      .three.wide.column.borderThing(style="background:#ffffff")
        .hText.mainColorlBlue
          | Employees In
        .lText=active_users.length + " (" + active_users.map(doc => doc.display_name).join(', ') + ")"
      .three.wide.column.borderThing(style="background:#ffffff")
        .hText.mainColorlBlue
          | Appointments Today
        .lText=active_tasks.length
      .three.wide.column.borderThing(style="background:#ffffff")
        .hText.mainColorlBlue
          | Total Expenses
        .lText="$" + user.total_time
  .ui.grid
    .three.column.row
      .column(style="background:#ffffff;margin-right: 50px; padding-bottom:10px;")
        .hText.mainColorlBlue
          | Who's Working
        .ui.relaxed.list
          .item
            img.ui.avatar.image(src='https://f0.pngfuel.com/png/312/283/man-face-clip-art-png-clip-art-thumbnail.png')
            .content
              a.header James Smith
              .description
                | Shipping 
                a
                  b Went for Lunch
                |  just now.
          .item
            img.ui.avatar.image(src='https://f0.pngfuel.com/png/312/283/man-face-clip-art-png-clip-art-thumbnail.png')
            .content
              a.header Timothy Miller
              .description
                | Equipment & Materials 
                a
                  b Last Online
                |  10 hours ago.
          .item
            img.ui.avatar.image(src='https://f0.pngfuel.com/png/312/283/man-face-clip-art-png-clip-art-thumbnail.png')
            .content
              a.header Sam Houston
              .description
                | Graphic Artist
                a
                  b Went for Lunch 
                |  just now.

     
      
      .column(style="background:#ffffff;padding-bottom:10px;")
        .hText.mainColorlBlue
          | Time Punch
        h1(style="text-align:center;") Current Date
        .circles
          button.round_circle.circle_lunch#lunch Lunch
          if user.time_windows.length && user.time_windows[user.time_windows.length-1].shift_end
            button.round_circle.circle_in.update#in In
          else
            button.round_circle.circle_out.update#out Out
          .table_text_block 
            span!=user.time_windows.length && user.time_windows[user.time_windows.length-1].shift_start ? "<b>IN</b> " + new Date(user.time_windows[user.time_windows.length-1].shift_start).toLocaleTimeString('en-US', { hour: 'numeric', minute: 'numeric' }) : "<b>---</b>"
            span!=user.time_windows.length && user.time_windows[user.time_windows.length-1].shift_end ? "<b>OUT</b> " + new Date(user.time_windows[user.time_windows.length-1].shift_end).toLocaleTimeString('en-US', { hour: 'numeric', minute: 'numeric' }) : "<b>---</b>"



        

block append js
  script.
    const update = document.getElementsByClassName('update');
    for (let upd of update) {
      upd.addEventListener('click', function () {
        let obj = {type: this.id};
        fetch(`/user/shift`, {
          method: 'PUT',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(obj)
        })
        .then(res => {
          if (res.ok) return res.json()
        })
        .then(data => {
          window.location.reload(true)
        })
      })
    }
