extends layout

block content
    h1= title
    table(id="calendar")
        caption=selected_week
        tr(class="weekdays")
            th(scope='col') Sunday
            th(scope='col') Monday
            th(scope='col') Tuesday
            th(scope='col') Wednesday
            th(scope='col') Thursday
            th(scope='col') Friday
            th(scope='col') Saturday
        tr(class="days")
            each val in [1, 2, 3, 4, 5, 6, 7]
                td.day
                    if days_arr[val]
                        .total-time=days_arr[val].toFixed(2).replace('.', ':')
    strong(style="text-align: right")
        p
            span.medium_text.half_opacity Total hours this week: 
            span.big_text=(Object.keys(days_arr).length ? Object.values(days_arr).reduce((a, b) => a + b).toFixed(2).replace('.', ':') : "0")
        p
            span.medium_text.half_opacity Overtime hours this week: 
            span.big_text=(Object.values(days_arr).filter(val => val > 8).length ? Object.values(days_arr).filter(val => val > 8).map(val => val - 8).reduce((a, b) => a + b).toFixed(2).replace('.', ':') : "0")
    
    
    .ui.modal.large#kek
        i.close.icon
        .ui.two.column.grid.row.whiteBg
            .column
                .formShit
                    form.ui.form
                        .field.eight.wide
                            
                            input(type='text', name='first-name', placeholder='First Name')
                        .field.eight.wide
                            
                            input(type='text', name='last-name', placeholder='Last Name')
                        .field
                            .ui.checkbox
                                input.hidden(type='checkbox', tabindex='0')
                                label Stay signed in
                        button.ui.button(type='submit', style='float:right;') Submit

            .column.cBlueBg
                .image.content
                    img.image(src='https://logofirmowe.pl/a/wp-content/uploads/2018/05/mcdonalds-definicja-logo-e1527206240422.png')

                
                

    .tableMain
        table.ui.celled.table
            thead
                tr
                th Day
                th In
                th Out
                th Lunch
                th Total
            tbody
                each time_window in user.time_windows
                    - var start = new Date(time_window.shift_start)
                    - var end = new Date(time_window.shift_end)
                    - var lunch_start = new Date(time_window.lunch_start)
                    - var lunch_end = new Date(time_window.lunch_end)
                    mixin tds
                        td=`${start.getHours()}:${start.getMinutes().toString().length === 1 ? "0" + start.getMinutes() : start.getMinutes()}`
                        td=`${end.getHours()}:${end.getMinutes().toString().length === 1 ? "0" + end.getMinutes() : end.getMinutes()}`
                        td=lunch_start && lunch_end ? `${lunch_start.getHours()}:${lunch_start.getMinutes().toString().length === 1 ? "0" + lunch_start.getMinutes() : lunch_start.getMinutes()} - ${lunch_end.getHours()}:${lunch_end.getMinutes().toString().length === 1 ? "0" + lunch_end.getMinutes() : lunch_end.getMinutes()}` : '---'
                        td=((time_window.shift_end-time_window.shift_start - (time_window.lunch_end-time_window.lunch_start))/3600000).toFixed(2).replace('.', ':')
                    tr(id=time_window._id)
                        if !time_window.status
                            td
                                .ui.form
                                    .inline.field
                                        .ui.checkbox
                                            input(type='checkbox', tabindex='0')
                                            label=start.toLocaleDateString("en-US", {month: 'long', day: 'numeric'})

                            +tds
                        else if time_window.status === 1
                            td.positive
                                i.icon.check
                                span.i_span=start.toLocaleDateString("en-US", {month: 'long', day: 'numeric'})
                            +tds
                        else
                            td.negative
                                i.icon.close
                                span.i_span=start.toLocaleDateString("en-US", {month: 'long', day: 'numeric'})
                            +tds
        button.ui.primary.button#update
            | Submit Hours For Approval
        
block append js
    script.
        function kek() {
            $('#kek')
            .modal({
                centered: false
            })
            .modal('show')
            ; }
        const upd = document.getElementById('update');
        upd.addEventListener('click', function () {
            const checked = document.querySelectorAll('input[type="checkbox"]:checked')
            if (!checked.length) return;
            const trs_ids = [...checked].map(el => el.closest('tr').id)
            fetch(`/user/hours/submit`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(trs_ids)
            })
            .then(res => {
                if (res.ok) return res.json()
            })
            .then(data => {
                window.location.reload(true)
            })
        })